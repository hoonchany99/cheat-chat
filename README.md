# 🩺 Savvy - AI 의료 차팅 어시스턴트

> **진료에만 집중하세요. 차트는 AI가 작성합니다.**

녹음 한 번이면 끝. 진료 대화가 EMR-ready 차트로 변환됩니다. 하루 30분, 차트 작성에서 해방되세요.

## ✨ 주요 기능

- 🎙️ **실시간 음성 인식** - Deepgram 스트리밍 STT로 대화를 즉시 텍스트로 변환
- 👥 **AI 화자 분류** - GPT-4o가 의사/환자 발화를 자동 구분
- 📋 **자동 차트 생성** - 진료과별 맞춤 차트 템플릿 (CC, PI, ROS, Assessment, Plan 등)
- 📂 **환자 세션 관리** - 최대 5명까지 동시 차트 작성 가능
- ✏️ **자유로운 편집** - AI 생성 후 직접 수정 및 보완 가능
- 🎯 **온보딩 UX** - 첫 방문 시 사용법 안내 및 데모 체험

---

## 🏗️ 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              사용자 브라우저                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐       │
│   │  VoiceRecorder  │───▶│ PatientSidebar  │    │ ChartingResult  │       │
│   │   (녹음 UI)     │    │ (세션 관리)     │    │  (차트 표시)    │       │
│   └────────┬────────┘    └────────▲────────┘    └────────▲────────┘       │
│            │                      │                      │                 │
│            │ 오디오 청크          │ 세션 전환            │ 생성된 차트     │
│            ▼                      │                      │                 │
│   ┌────────────────────────────────────────────────────────────────┐      │
│   │                         App.tsx                                 │      │
│   │                    (상태 관리 + 세션 관리)                      │      │
│   └────────┬─────────────────────────────────────────────┬─────────┘      │
│            │                                             │                 │
└────────────┼─────────────────────────────────────────────┼─────────────────┘
             │                                             │
             ▼                                             ▼
┌────────────────────────────┐              ┌────────────────────────────┐
│     deepgramService.ts     │              │      chartService.ts       │
│  ┌──────────────────────┐  │              │  ┌──────────────────────┐  │
│  │ DeepgramRealtime     │  │              │  │  generateChart()     │  │
│  │ Transcriber          │  │              │  │                      │  │
│  │ - WebSocket 연결     │  │              │  │  - 진료과별 프리셋   │  │
│  │ - 발화 수집          │  │              │  │  - GPT 프롬프트      │  │
│  │ - 배치 화자 분류     │  │              │  │  - Assessment/DDx    │  │
│  └──────────┬───────────┘  │              │  └──────────┬───────────┘  │
└─────────────┼──────────────┘              └─────────────┼──────────────┘
              │                                           │
              ▼                                           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              외부 API                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────┐       ┌─────────────────────────────────┐   │
│   │       Deepgram          │       │           OpenAI                 │   │
│   │   (실시간 STT)          │       │                                  │   │
│   │                         │       │  ┌─────────────────────────────┐│   │
│   │  • Nova-2 모델          │       │  │ GPT-4o                      ││   │
│   │  • 한국어 지원          │       │  │ • 실시간 화자 분류          ││   │
│   │  • WebSocket 스트리밍   │       │  │ • 최종 화자 분류            ││   │
│   │  • VAD (발화 감지)      │       │  │ • 차트 생성                 ││   │
│   │                         │       │  └─────────────────────────────┘│   │
│   └─────────────────────────┘       └─────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 📋 차트 필드 구조

### 기본 차트 필드

| 필드 | 설명 |
|------|------|
| **CC** | Chief Complaint - 주호소 |
| **PI** | Present Illness - 현병력 |
| **ROS (+/-)** | Review of Systems - 관련 증상 |
| **Past History** | 과거력 (Surgical History, Medications, Allergies 포함) |
| **Social History** | 사회력 |
| **Family History** | 가족력 |
| **PE** | Physical Examination - 진찰소견 (소견 있을 때만 표시) |
| **Assessment** | 평가 - #Dx (확정진단), r/o (감별진단) 포함 |
| **Plan** | 치료 계획 |
| **Notes** | 기타 메모 |

---

## 🔄 데이터 흐름

### 1️⃣ 녹음 → 실시간 전사 (Deepgram)

```
마이크 입력
    │
    ▼ MediaRecorder (250ms 청크)
    │
    ▼ WebSocket
    │
    ▼ Deepgram Nova-2 (한국어)
    │
    ▼ 실시간 텍스트 반환
    │
    └──▶ utterances[] 배열에 추가
```

### 2️⃣ 실시간 화자 분류 (GPT-4o)

```
새 발화 추가
    │
    ▼ 2초 디바운스
    │
    ▼ 최근 5개 발화 추출
    │
    ▼ GPT-4o API 호출
    │
    ├──▶ 번호 기반 화자 분류 (D/P)
    │    "1. 어디가 아프세요?" → D
    │    "2. 머리가 아파요" → P
    │
    ▼ 인덱스 기반 병합
    │
    └──▶ classifiedSegments[] 업데이트
```

### 3️⃣ 차트 자동 생성 (GPT-4o)

```
녹음 종료
    │
    ▼ 대화 텍스트 포맷팅
    │
    ▼ 진료과별 프리셋 적용
    │
    ▼ GPT-4o Streaming API
    │
    ▼ 실시간 차트 업데이트
    │
    └──▶ Assessment에 DDx 통합 (#Dx, r/o)
```

---

## 📁 프로젝트 구조

```
savvy/
├── src/
│   ├── app/
│   │   ├── App.tsx                    # 메인 앱 (상태 + 세션 관리)
│   │   └── components/
│   │       ├── LandingPage.tsx        # 랜딩 페이지
│   │       ├── DemoPage.tsx           # 데모 체험 페이지
│   │       ├── VoiceRecorder.tsx      # 녹음 UI + MediaRecorder
│   │       ├── ChartingResult.tsx     # 차트 표시/편집
│   │       ├── PatientSidebar.tsx     # 환자 세션 사이드바
│   │       ├── ChartSettingsModal.tsx # 진료과/필드 설정
│   │       └── ui/                    # shadcn/ui 컴포넌트
│   │
│   ├── services/
│   │   ├── deepgramService.ts         # Deepgram 실시간 STT + GPT 화자 분류
│   │   └── chartService.ts            # 진료과 프리셋 + GPT 차트 생성
│   │
│   └── styles/
│       └── index.css                  # 글로벌 스타일 + Tailwind
│
├── index.html
├── vite.config.ts
├── package.json
└── .env                               # API 키
```

---

## 🚀 실행 방법

### 1. 의존성 설치

```bash
npm install
```

### 2. 환경변수 설정

`.env` 파일 생성:

```env
VITE_DEEPGRAM_API_KEY=your_deepgram_api_key
VITE_OPENAI_API_KEY=your_openai_api_key
```

### 3. 개발 서버 실행

```bash
npm run dev
```

### 4. 빌드

```bash
npm run build
```

---

## 🔧 기술 스택

| 분류 | 기술 |
|------|------|
| **Frontend** | React 18, TypeScript, Vite |
| **Styling** | Tailwind CSS 4, Radix UI (shadcn/ui) |
| **음성 인식** | Deepgram Nova-2 (WebSocket 스트리밍) |
| **AI** | OpenAI GPT-4o (화자 분류 + 차트 생성) |
| **상태 관리** | React useState/useRef/useCallback |

---

## 🎯 사용 시나리오

1. **페이지 진입** - 첫 방문 시 환영 모달로 사용법 안내
2. **데모 체험** - ▶ 버튼으로 샘플 진료 대화 시뮬레이션
3. **녹음 시작** - 마이크 버튼 클릭
4. **대화 진행** - 의사-환자 대화가 실시간으로 텍스트로 변환
5. **차트 자동 생성** - AI가 진료과별 차트 템플릿에 맞춰 작성
6. **편집 및 복사** - 필요시 수정 후 EMR에 붙여넣기
7. **다음 환자** - 사이드바에서 새 환자 추가 (최대 5명)

---

## 📊 API 사용량

| 기능 | 모델 | 호출 시점 |
|------|------|-----------|
| 실시간 화자 분류 | GPT-4o | 발화 추가 후 2초 디바운스 |
| 차트 생성 | GPT-4o (Streaming) | 녹음 중 + 종료 시 |

---

## 📝 라이선스

MIT License

© 2026 Utopify Technologies
